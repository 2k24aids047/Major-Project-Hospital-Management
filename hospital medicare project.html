<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediCare - Hospital Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ALL STYLES FROM YOUR CODE ARE HERE */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 1200px;
            overflow: hidden;
            height: 90vh;
        }

        .header {
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .logo i {
            background: white;
            color: #1a2980;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }

        .tagline {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .login-container {
            padding: 40px;
            overflow-y: auto;
            max-height: 70vh;
        }

        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        .tab {
            padding: 12px 30px;
            border: 2px solid #1a2980;
            background: white;
            color: #1a2980;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab.active {
            background: #1a2980;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(26, 41, 128, 0.2);
        }

        .login-form {
            display: none;
            animation: fadeIn 0.5s;
        }

        .login-form.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #1a2980;
        }

        .btn {
            padding: 16px;
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(26, 41, 128, 0.2);
        }

        .emergency-contact {
            margin-top: 30px;
            padding: 20px;
            background: #fff5f5;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #ff4757;
        }

        .emergency-contact h4 {
            color: #ff4757;
            margin-bottom: 10px;
        }

        .emergency-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: #ff4757;
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .emergency-btn:hover {
            background: #ff3742;
            transform: scale(1.05);
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .feature-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-top: 4px solid #1a2980;
        }

        .feature-card i {
            font-size: 2.5rem;
            color: #1a2980;
            margin-bottom: 15px;
        }

        /* DASHBOARD STYLES */
        .dashboard {
            display: none;
            height: 90vh;
        }

        .sidebar {
            width: 250px;
            background: #1a2980;
            color: white;
            padding: 30px 0;
            height: 100%;
            overflow-y: auto;
            float: left;
        }

        .user-profile {
            text-align: center;
            padding: 0 20px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #1a2980;
            font-weight: bold;
        }

        .user-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .user-role {
            color: #26d0ce;
            font-size: 0.9rem;
        }

        .menu {
            padding: 20px 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 25px;
            color: white;
            text-decoration: none;
            transition: background 0.3s;
            cursor: pointer;
            border-left: 4px solid transparent;
        }

        .menu-item:hover,
        .menu-item.active {
            background: rgba(255, 255, 255, 0.1);
            border-left: 4px solid #26d0ce;
        }

        .menu-item i {
            font-size: 1.2rem;
            width: 24px;
        }

        .main-content {
            margin-left: 250px;
            padding: 30px;
            background: #f8f9fa;
            height: 100%;
            overflow-y: auto;
        }

        .page-header {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .page-title {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.8rem;
            color: #1a2980;
            margin-bottom: 10px;
        }

        .content-area {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            min-height: 400px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card i {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .stat-card h3 {
            font-size: 2.5rem;
            margin: 10px 0;
        }

        .doctors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .doctor-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
            transition: transform 0.3s;
        }

        .doctor-card:hover {
            transform: translateY(-5px);
        }

        .doctor-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .doctor-avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            font-weight: bold;
        }

        .specialty-badge {
            background: #e3f2fd;
            color: #1a2980;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            display: inline-block;
            margin-top: 5px;
        }

        .book-btn {
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            margin-top: 15px;
            font-weight: 600;
            transition: opacity 0.3s;
        }

        .book-btn:hover {
            opacity: 0.9;
        }

        .search-box {
            position: relative;
            margin-bottom: 30px;
        }

        .search-box input {
            width: 100%;
            padding: 15px 20px 15px 50px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
        }

        .search-box i {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }

        /* CHATBOT STYLES */
        .chatbot-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .chatbot-header {
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }

        .chatbot-avatar {
            width: 70px;
            height: 70px;
            background: white;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #1a2980;
        }

        .chat-messages {
            height: 400px;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 20px;
            max-width: 80%;
        }

        .message.user {
            margin-left: auto;
        }

        .message-content {
            padding: 15px;
            border-radius: 15px;
            position: relative;
        }

        .message.bot .message-content {
            background: white;
            border: 1px solid #e0e0e0;
            border-bottom-left-radius: 5px;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message-time {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
            text-align: right;
        }

        .quick-questions {
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .quick-question {
            background: white;
            border: 1px solid #e0e0e0;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .quick-question:hover {
            background: #1a2980;
            color: white;
            border-color: #1a2980;
        }

        .chat-input {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
        }

        .send-btn {
            width: 50px;
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* PHARMACY STYLES */
        .medicines-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        .medicine-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
            transition: transform 0.3s;
        }

        .medicine-card:hover {
            transform: translateY(-5px);
        }

        .medicine-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .medicine-icon {
            width: 60px;
            height: 60px;
            background: #e3f2fd;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #1a2980;
        }

        .category-badge {
            background: #f3e5f5;
            color: #7b1fa2;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin: 10px 0;
            display: inline-block;
        }

        .price {
            color: #1a2980;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 15px 0;
        }

        .buy-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-weight: 600;
            transition: opacity 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .buy-btn:hover {
            opacity: 0.9;
        }

        .prescription-badge {
            background: #fff5f5;
            color: #ff4757;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }

        /* MODAL STYLES */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            position: absolute;
            right: 20px;
            top: 20px;
            color: #666;
        }

        /* LOGOUT BUTTON */
        .logout-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 20px;
            width: calc(100% - 40px);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* APPOINTMENT BOOKING */
        .symptoms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .symptom-card {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .symptom-card.selected {
            background: #1a2980;
            color: white;
            border-color: #1a2980;
        }

        .appointment-form {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .container {
                border-radius: 10px;
                height: auto;
                min-height: 90vh;
            }
            
            .sidebar {
                width: 100%;
                float: none;
                height: auto;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .doctors-grid,
            .medicines-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard {
                height: auto;
            }
        }

        /* PATIENTS TABLE */
        .patients-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .patients-table th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e0e0e0;
        }

        .patients-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .patients-table tr:hover {
            background: #f8f9fa;
        }

        .action-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            margin: 0 5px;
        }

        .action-btn.secondary {
            background: #4CAF50;
        }

        /* CART STYLES */
        .cart-badge {
            position: relative;
            cursor: pointer;
            margin-left: auto;
        }

        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4757;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .qty-btn {
            width: 30px;
            height: 30px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
        }

        /* PAGE TRANSITION */
        .page {
            display: none;
            animation: fadeIn 0.5s;
        }

        .page.active {
            display: block;
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* ========== NEW ENHANCEMENT STYLES ========== */
        /* Status badges for appointment workflow */
        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }

        .status-requested {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status-approved {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-completed {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Stock indicators */
        .stock-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .stock-in { 
            background: #28a745; 
        }
        
        .stock-low { 
            background: #ffc107; 
            animation: pulse 2s infinite; 
        }
        
        .stock-out { 
            background: #dc3545; 
        }

        .low-stock {
            color: #ff6b6b;
            font-weight: bold;
        }

        .out-of-stock {
            color: #dc3545;
            font-weight: bold;
            text-decoration: line-through;
        }

        .in-stock {
            color: #28a745;
            font-weight: bold;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Time slot selection */
        .time-slot {
            display: inline-block;
            padding: 8px 15px;
            margin: 5px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .time-slot.selected {
            background: #1a2980;
            color: white;
            border-color: #1a2980;
        }

        .time-slot.unavailable {
            background: #f8f9fa;
            color: #999;
            cursor: not-allowed;
            text-decoration: line-through;
        }

        .time-slots-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        /* Export/Print buttons */
        .export-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .print-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        /* Appointment and prescription cards */
        .appointment-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border-left: 4px solid #1a2980;
        }

        .appointment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .appointment-actions {
            display: flex;
            gap: 10px;
        }

        .prescription-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border-left: 4px solid #4CAF50;
        }

        .prescription-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .history-section {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }

        /* Doctor availability indicator */
        .availability-badge {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .available {
            background: #d4edda;
            color: #155724;
        }

        .unavailable {
            background: #f8d7da;
            color: #721c24;
        }

        /* Tab navigation for new sections */
        .sub-tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 20px;
        }

        .sub-tab {
            padding: 12px 25px;
            background: none;
            border: none;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .sub-tab.active {
            color: #1a2980;
            border-bottom: 3px solid #1a2980;
        }

        /* Print styles */
        @media print {
            body * {
                visibility: hidden;
            }
            
            .print-content, .print-content * {
                visibility: visible;
            }
            
            .print-content {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 20px;
            }
            
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- LOGIN PAGE -->
    <div class="container" id="login-container">
        <div class="header">
            <div class="logo">
                <i class="fas fa-hospital-alt"></i>
                MediCare
            </div>
            <div class="tagline">Advanced Hospital Management System</div>
        </div>
        
        <div class="login-container">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('patient')">Patient</div>
                <div class="tab" onclick="switchTab('doctor')">Doctor</div>
                <div class="tab" onclick="switchTab('admin')">Admin</div>
            </div>
            
            <!-- Patient Login -->
            <div class="login-form active" id="patient-login">
                <div class="form-group">
                    <label><i class="fas fa-user"></i> Patient ID / Email</label>
                    <input type="text" id="patient-email" placeholder="Enter Patient ID or Email">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="patient-password" placeholder="Enter Password">
                </div>
                <button class="btn" onclick="login('patient')">
                    <i class="fas fa-sign-in-alt"></i> Login as Patient
                </button>
                <p style="text-align: center; margin-top: 20px; color: #666;">
                    Demo Login: Use any credentials
                </p>
            </div>
            
            <!-- Doctor Login -->
            <div class="login-form" id="doctor-login">
                <div class="form-group">
                    <label><i class="fas fa-user-md"></i> Doctor ID</label>
                    <input type="text" id="doctor-id" placeholder="Enter Doctor ID">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="doctor-password" placeholder="Enter Password">
                </div>
                <button class="btn" onclick="login('doctor')">
                    <i class="fas fa-sign-in-alt"></i> Login as Doctor
                </button>
                <p style="text-align: center; margin-top: 20px; color: #666;">
                    Demo Login: Use any credentials
                </p>
            </div>
            
            <!-- Admin Login -->
            <div class="login-form" id="admin-login">
                <div class="form-group">
                    <label><i class="fas fa-shield-alt"></i> Admin ID</label>
                    <input type="text" id="admin-id" placeholder="Enter Admin ID">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="admin-password" placeholder="Enter Password">
                </div>
                <button class="btn" onclick="login('admin')">
                    <i class="fas fa-sign-in-alt"></i> Login as Admin
                </button>
                <p style="text-align: center; margin-top: 20px; color: #666;">
                    Demo Login: Use any credentials
                </p>
            </div>
            
            <div class="emergency-contact">
                <h4><i class="fas fa-ambulance"></i> Emergency Contact</h4>
                <p>For emergency medical assistance, call our 24/7 helpline:</p>
                <a href="tel:108" class="emergency-btn">
                    <i class="fas fa-phone-alt"></i> Call Emergency: 108
                </a>
            </div>
            
            <div class="features">
                <div class="feature-card">
                    <i class="fas fa-user-md"></i>
                    <h4>Expert Doctors</h4>
                    <p>Consult with 10+ specialized doctors</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-robot"></i>
                    <h4>AI Symptom Checker</h4>
                    <p>Get instant symptom analysis</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-pills"></i>
                    <h4>Online Pharmacy</h4>
                    <p>Order medicines with prescription</p>
                </div>
            </div>
        </div>
    </div>

    <!-- DASHBOARD CONTAINER (Hidden until login) -->
    <div class="container dashboard" id="dashboard">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="user-profile">
                <div class="user-avatar" id="user-avatar">U</div>
                <div class="user-name" id="user-name">User Name</div>
                <div class="user-role" id="user-role">Patient</div>
            </div>
            
            <div class="menu">
                <div class="menu-item active" onclick="showPage('dashboard-home')">
                    <i class="fas fa-home"></i> Dashboard
                </div>
                <div class="menu-item" onclick="showPage('book-appointment')">
                    <i class="fas fa-calendar-plus"></i> Book Appointment
                </div>
                <div class="menu-item" onclick="showPage('doctors')">
                    <i class="fas fa-user-md"></i> Doctors
                </div>
                <div class="menu-item" onclick="showPage('pharmacy')">
                    <i class="fas fa-pills"></i> Pharmacy
                    <span class="cart-count" id="cart-count">0</span>
                </div>
                <div class="menu-item" onclick="showPage('chatbot')">
                    <i class="fas fa-robot"></i> AI Assistant
                </div>
                <div class="menu-item" onclick="showPage('appointment-mgmt')">
                    <i class="fas fa-calendar-alt"></i> My Appointments
                </div>
                <div class="menu-item" onclick="showPage('prescription-history')" id="prescription-menu">
                    <i class="fas fa-prescription"></i> Prescriptions
                </div>
                <div class="menu-item" onclick="showPage('patients')" id="patients-menu">
                    <i class="fas fa-users"></i> Patients
                </div>
            </div>
            
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
        
        <!-- Main Content Area -->
        <div class="main-content">
            <!-- DASHBOARD HOME PAGE -->
            <div class="page active" id="dashboard-home">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-home"></i> Dashboard
                    </h1>
                    <p>Welcome to MediCare Hospital Management System</p>
                </div>
                
                <div class="content-area">
                    <div class="stats-grid" id="dashboard-stats">
                        <!-- Stats loaded by JavaScript -->
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h3><i class="fas fa-bell"></i> Recent Notifications</h3>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 10px;">
                            <p>âœ… Appointment confirmed with Dr. Arjun Kumar for tomorrow</p>
                            <p>ðŸ“¦ Your medicines will be delivered today</p>
                            <p>ðŸ“‹ Lab reports are ready to download</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- BOOK APPOINTMENT PAGE -->
            <div class="page" id="book-appointment">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-calendar-plus"></i> Book Appointment
                    </h1>
                    <p>Select symptoms to find the right specialist</p>
                </div>
                
                <div class="content-area">
                    <div class="symptom-checker" style="margin-bottom: 30px;">
                        <h3><i class="fas fa-stethoscope"></i> Symptom Checker</h3>
                        <p>Select your symptoms:</p>
                        
                        <div class="symptoms-grid" id="symptoms-grid">
                            <div class="symptom-card" data-symptom="Fever">ðŸ¤’ Fever</div>
                            <div class="symptom-card" data-symptom="Headache">ðŸ¤• Headache</div>
                            <div class="symptom-card" data-symptom="Cough">ðŸ˜· Cough</div>
                            <div class="symptom-card" data-symptom="Cold">ðŸ¤§ Cold</div>
                            <div class="symptom-card" data-symptom="Dizziness">ðŸ’« Dizziness</div>
                            <div class="symptom-card" data-symptom="Vomiting">ðŸ¤¢ Vomiting</div>
                            <div class="symptom-card" data-symptom="Chest Pain">ðŸ’” Chest Pain</div>
                            <div class="symptom-card" data-symptom="Joint Pain">ðŸ¦µ Joint Pain</div>
                        </div>
                        
                        <textarea id="additional-symptoms" placeholder="Describe additional symptoms in detail..." 
                                  style="width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; margin: 20px 0; min-height: 100px; font-family: inherit;"></textarea>
                        
                        <button class="btn" onclick="findDoctorBySymptoms()" style="width: 100%;">
                            <i class="fas fa-search"></i> Find Recommended Doctor
                        </button>
                    </div>

                    <div id="doctor-recommendation" style="margin: 30px 0;"></div>

                    <div class="appointment-form">
                        <h3><i class="fas fa-calendar-alt"></i> Appointment Details</h3>
                        
                        <div class="form-group">
                            <label>Select Doctor</label>
                            <select id="appointment-doctor" class="form-control" onchange="updateConsultationFee(); loadDoctorAvailability();">
                                <option value="">-- Choose a specialist --</option>
                            </select>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                            <div class="form-group">
                                <label>Appointment Date</label>
                                <input type="date" id="appointment-date" class="form-control" min="" onchange="loadAvailableSlots()">
                            </div>
                            
                            <div class="form-group">
                                <label>Select Time Slot</label>
                                <select id="appointment-time" class="form-control">
                                    <option value="">-- Select Time --</option>
                                </select>
                            </div>
                        </div>

                        <!-- NEW: Doctor Availability Time Slots -->
                        <div id="doctor-availability-section" style="display: none;">
                            <h4><i class="fas fa-clock"></i> Doctor's Available Time Slots</h4>
                            <div class="time-slots-container" id="time-slots-container">
                                <!-- Time slots loaded dynamically -->
                            </div>
                            <p style="color: #666; font-size: 0.9rem; margin-top: 10px;">
                                <i class="fas fa-info-circle"></i> Green slots are available, gray slots are unavailable
                            </p>
                        </div>
                        
                        <div class="form-group">
                            <label>Consultation Type</label>
                            <div style="display: flex; gap: 15px; margin-top: 5px;">
                                <label style="display: flex; align-items: center; gap: 8px; padding: 12px 20px; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer; transition: all 0.3s; flex: 1; justify-content: center;">
                                    <input type="radio" name="consultation-type" value="clinic" checked>
                                    <i class="fas fa-hospital"></i> In-Clinic
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; padding: 12px 20px; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer; transition: all 0.3s; flex: 1; justify-content: center;">
                                    <input type="radio" name="consultation-type" value="video">
                                    <i class="fas fa-video"></i> Video Call
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Symptoms Details</label>
                            <textarea id="appointment-symptoms" class="form-control" rows="4" placeholder="Describe your symptoms in detail..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Consultation Fee</label>
                            <div style="font-size: 1.8rem; color: #1a2980; font-weight: bold; padding: 20px; background: #f8f9fa; border-radius: 10px; text-align: center;">
                                â‚¹<span id="consultation-fee">500</span>
                                <div style="font-size: 0.9rem; color: #666; margin-top: 5px;">Includes GST and consultation charges</div>
                            </div>
                        </div>
                        
                        <button class="btn" onclick="bookAppointment()" style="width: 100%;">
                            <i class="fas fa-calendar-check"></i> Confirm Booking
                        </button>
                    </div>
                </div>
            </div>

            <!-- DOCTORS PAGE -->
            <div class="page" id="doctors">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-user-md"></i> Our Medical Specialists
                    </h1>
                    <p>10+ expert doctors with strong careers</p>
                </div>
                
                <div class="content-area">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="doctor-search" placeholder="Search doctors by name or specialization..." onkeyup="searchDoctors()">
                    </div>
                    
                    <div class="doctors-grid" id="doctors-list">
                        <!-- Doctors loaded by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- PHARMACY PAGE -->
            <div class="page" id="pharmacy">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-pills"></i> Hospital Pharmacy
                    </h1>
                    <p>20+ verified medicines with doorstep delivery</p>
                </div>
                
                <div class="content-area">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="medicine-search" placeholder="Search medicines..." onkeyup="searchMedicines()">
                    </div>
                    
                    <div class="medicines-grid" id="medicines-list">
                        <!-- Medicines loaded by JavaScript -->
                    </div>
                    
                    <div style="text-align: center; margin-top: 40px;">
                        <button class="btn" onclick="viewCart()" style="margin-right: 15px;">
                            <i class="fas fa-shopping-cart"></i> View Cart (<span id="cart-count-header">0</span>)
                        </button>
                        <button class="btn" onclick="uploadPrescription()">
                            <i class="fas fa-upload"></i> Upload Prescription
                        </button>
                    </div>
                </div>
            </div>

            <!-- CHATBOT PAGE -->
            <div class="page" id="chatbot">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-robot"></i> AI Medical Assistant
                    </h1>
                    <p>Get instant symptom analysis and health tips</p>
                </div>
                
                <div class="content-area">
                    <div class="chatbot-container">
                        <div class="chatbot-header">
                            <div class="chatbot-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div>
                                <h3>Dr. AI Assistant</h3>
                                <p>AI-powered medical diagnosis and guidance</p>
                                <div style="display: flex; align-items: center; gap: 5px; font-size: 0.9rem; opacity: 0.9; margin-top: 5px;">
                                    <span style="width: 8px; height: 8px; background: #4CAF50; border-radius: 50%;"></span> Online
                                </div>
                            </div>
                        </div>
                        
                        <div class="chat-messages" id="chat-messages">
                            <div class="message bot">
                                <div class="message-content">
                                    <strong>ðŸ‘‹ Hello! I'm Dr. AI, your intelligent medical assistant.</strong>
                                    <br><br>
                                    I can help you with:
                                    <br><br>
                                    â€¢ <strong>Symptom Analysis:</strong> Describe your symptoms for preliminary assessment<br>
                                    â€¢ <strong>Medicine Information:</strong> Get details about medicines and dosage<br>
                                    â€¢ <strong>First Aid Guidance:</strong> Emergency medical advice<br>
                                    â€¢ <strong>Doctor Recommendation:</strong> Find the right specialist for your condition<br>
                                    â€¢ <strong>Health Tips:</strong> Preventive care and wellness advice<br>
                                    <br>
                                    <em>Note: I'm an AI assistant. For medical emergencies, please call 108 immediately.</em>
                                    <br><br>
                                    What can I help you with today?
                                </div>
                                <div class="message-time">Just now</div>
                            </div>
                        </div>
                        
                        <div class="quick-questions">
                            <div class="quick-question" onclick="askQuickQuestion('I have fever and headache')">ðŸ¤’ Fever & Headache</div>
                            <div class="quick-question" onclick="askQuickQuestion('Cough and cold remedies')">ðŸ˜· Cough & Cold</div>
                            <div class="quick-question" onclick="askQuickQuestion('Stomach pain and nausea')">ðŸ¤¢ Stomach Issues</div>
                            <div class="quick-question" onclick="askQuickQuestion('Dizziness and weakness')">ðŸ’« Dizziness</div>
                            <div class="quick-question" onclick="askQuickQuestion('Check medicine side effects')">ðŸ’Š Medicine Info</div>
                        </div>
                        
                        <div class="chat-input">
                            <input type="text" id="chat-input" placeholder="Describe your symptoms or ask a medical question..." onkeypress="handleChatEnter(event)">
                            <button class="send-btn" onclick="sendChatbotMessage()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- APPOINTMENT MANAGEMENT PAGE (NEW) -->
            <div class="page" id="appointment-mgmt">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-calendar-alt"></i> Appointment Management
                    </h1>
                    <p>View and manage your appointments</p>
                </div>
                
                <div class="content-area">
                    <div class="sub-tabs">
                        <button class="sub-tab active" onclick="showAppointmentTab('my-appointments')">My Appointments</button>
                        <button class="sub-tab" onclick="showAppointmentTab('manage-appointments')" id="manage-appointments-tab" style="display: none;">Manage Appointments</button>
                    </div>
                    
                    <div id="my-appointments-content">
                        <div class="action-buttons">
                            <button class="export-btn" onclick="exportAppointments()">
                                <i class="fas fa-download"></i> Export to CSV
                            </button>
                            <button class="print-btn" onclick="printAppointments()">
                                <i class="fas fa-print"></i> Print List
                            </button>
                        </div>
                        
                        <div class="history-section" id="appointments-list">
                            <!-- Appointments loaded dynamically -->
                        </div>
                    </div>
                    
                    <div id="manage-appointments-content" style="display: none;">
                        <h3>Manage Patient Appointments</h3>
                        <div id="all-appointments-list">
                            <!-- All appointments for admin/doctor -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- PRESCRIPTION HISTORY PAGE (NEW) -->
            <div class="page" id="prescription-history">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-prescription"></i> Prescription History
                    </h1>
                    <p>View your medical prescriptions</p>
                </div>
                
                <div class="content-area">
                    <div class="action-buttons">
                        <button class="export-btn" onclick="exportPrescriptions()">
                            <i class="fas fa-download"></i> Export Prescriptions
                        </button>
                        <button class="print-btn" onclick="printPrescription()">
                            <i class="fas fa-print"></i> Print Prescription
                        </button>
                    </div>
                    
                    <div class="history-section" id="prescriptions-list">
                        <!-- Prescriptions loaded dynamically -->
                    </div>
                </div>
            </div>

            <!-- PATIENTS PAGE (Admin/Doctor only) -->
            <div class="page" id="patients">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-users"></i> Patients Database
                    </h1>
                    <p>Manage patient records and information</p>
                </div>
                
                <div class="content-area">
                    <div id="patients-table">
                        <!-- Patients loaded by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL FOR APPOINTMENT BOOKING -->
    <div class="modal" id="appointment-modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">Ã—</button>
            <h3 id="modal-title">Book Appointment</h3>
            <div id="modal-body"></div>
        </div>
    </div>

    <!-- MODAL FOR CART -->
    <div class="modal" id="cart-modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeCart()">Ã—</button>
            <h3><i class="fas fa-shopping-cart"></i> Shopping Cart</h3>
            <div id="cart-items"></div>
            <div class="cart-summary" id="cart-summary"></div>
            <button class="btn" onclick="checkout()" style="width: 100%; margin-top: 20px;">
                <i class="fas fa-credit-card"></i> Proceed to Checkout
            </button>
        </div>
    </div>

    <!-- PRINTABLE CONTENT (HIDDEN) -->
    <div id="print-content" style="display: none;"></div>

    <script>
        // ========== ENHANCED GLOBAL DATA ==========
        const doctors = [
            { 
                id: 1, 
                name: "Dr. Arjun Kumar", 
                specialty: "General Physician", 
                experience: "15 years", 
                treats: "Fever, Cold, Cough, Headache, Weakness", 
                fee: 500,
                availability: {
                    "09:00 AM": true,
                    "10:30 AM": true,
                    "02:00 PM": false, // Unavailable
                    "04:30 PM": true,
                    "06:00 PM": true
                },
                workingDays: ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat"]
            },
            { 
                id: 2, 
                name: "Dr. Meera Srinivasan", 
                specialty: "Cardiologist", 
                experience: "12 years", 
                treats: "Chest Pain, BP, Heart Disease, Dizziness", 
                fee: 800,
                availability: {
                    "10:00 AM": true,
                    "11:30 AM": true,
                    "03:00 PM": true,
                    "05:00 PM": false
                },
                workingDays: ["Mon", "Wed", "Fri", "Sat"]
            },
            { 
                id: 3, 
                name: "Dr. Raghav Sharma", 
                specialty: "Neurologist", 
                experience: "18 years", 
                treats: "Migraine, Vertigo, Seizures, Chronic Headache", 
                fee: 700,
                availability: {
                    "09:30 AM": true,
                    "11:00 AM": true,
                    "04:00 PM": true,
                    "06:30 PM": true
                },
                workingDays: ["Tue", "Wed", "Thu", "Fri"]
            },
            { 
                id: 4, 
                name: "Dr. Priya Nair", 
                specialty: "ENT Specialist", 
                experience: "10 years", 
                treats: "Cold, Cough, Sinus, Ear Pain, Throat Infection", 
                fee: 600,
                availability: {
                    "09:00 AM": true,
                    "10:30 AM": true,
                    "02:00 PM": true,
                    "04:30 PM": true
                },
                workingDays: ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat"]
            },
            { 
                id: 5, 
                name: "Dr. Mohammed Faisal", 
                specialty: "Orthopedic", 
                experience: "20 years", 
                treats: "Body Pain, Joint Pain, Fracture", 
                fee: 750,
                availability: {
                    "08:00 AM": true,
                    "12:00 PM": true,
                    "03:00 PM": true,
                    "05:00 PM": false
                },
                workingDays: ["Mon", "Tue", "Thu", "Fri"]
            }
        ];

        // Enhanced medicines with stock data
        const medicines = [
            { 
                id: 1, 
                name: "Paracetamol 500mg", 
                category: "Common Symptoms", 
                usedFor: "Fever, Headache, Body Pain", 
                type: "Tablet", 
                price: 20, 
                prescription: false,
                stock: 45, // Stock count
                minStock: 20 // Minimum stock threshold
            },
            { 
                id: 2, 
                name: "Ibuprofen 400mg", 
                category: "Common Symptoms", 
                usedFor: "Pain, Fever", 
                type: "Tablet", 
                price: 35, 
                prescription: false,
                stock: 30,
                minStock: 15
            },
            { 
                id: 3, 
                name: "Cetirizine 10mg", 
                category: "Common Symptoms", 
                usedFor: "Cold, Allergy", 
                type: "Tablet", 
                price: 30, 
                prescription: false,
                stock: 60,
                minStock: 20
            },
            { 
                id: 4, 
                name: "Cough Syrup", 
                category: "Common Symptoms", 
                usedFor: "Cough", 
                type: "Syrup", 
                price: 90, 
                prescription: false,
                stock: 25,
                minStock: 10
            },
            { 
                id: 5, 
                name: "ORS Powder", 
                category: "Common Symptoms", 
                usedFor: "Weakness, Dehydration", 
                type: "Powder", 
                price: 25, 
                prescription: false,
                stock: 15, // Low stock
                minStock: 20
            },
            { 
                id: 6, 
                name: "Ondansetron 4mg", 
                category: "Digestive", 
                usedFor: "Nausea, Vomiting", 
                type: "Tablet", 
                price: 60, 
                prescription: true,
                stock: 0, // Out of stock
                minStock: 10
            },
            { 
                id: 7, 
                name: "Domperidone 10mg", 
                category: "Digestive", 
                usedFor: "Vomiting, Acidity", 
                type: "Tablet", 
                price: 45, 
                prescription: true,
                stock: 8, // Low stock
                minStock: 10
            },
            { 
                id: 8, 
                name: "Pantoprazole 40mg", 
                category: "Digestive", 
                usedFor: "Gastric Issues", 
                type: "Tablet", 
                price: 70, 
                prescription: true,
                stock: 35,
                minStock: 10
            },
            { 
                id: 9, 
                name: "Vertin 16mg", 
                category: "Neuro", 
                usedFor: "Dizziness, Vertigo", 
                type: "Tablet", 
                price: 85, 
                prescription: true,
                stock: 22,
                minStock: 10
            },
            { 
                id: 10, 
                name: "Amoxicillin 250mg", 
                category: "Infections", 
                usedFor: "Bacterial Infection", 
                type: "Capsule", 
                price: 80, 
                prescription: true,
                stock: 40,
                minStock: 15
            }
        ];

        const patients = [
            { id: 1, name: "Ramesh Kumar", age: 45, gender: "Male", condition: "Fever", lastVisit: "2024-02-15" },
            { id: 2, name: "Anitha Devi", age: 32, gender: "Female", condition: "Vomiting", lastVisit: "2024-02-14" },
            { id: 3, name: "Suresh Babu", age: 60, gender: "Male", condition: "Dizziness", lastVisit: "2024-02-13" },
            { id: 4, name: "Priya Sharma", age: 25, gender: "Female", condition: "Headache", lastVisit: "2024-02-12" },
            { id: 5, name: "Rahman Ali", age: 50, gender: "Male", condition: "Chest Pain", lastVisit: "2024-02-11" }
        ];

        // ========== GLOBAL VARIABLES ==========
        let currentUser = null;
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let selectedSymptoms = [];
        
        // NEW: Appointments and Prescriptions data
        let appointments = JSON.parse(localStorage.getItem('appointments')) || [];
        let prescriptions = JSON.parse(localStorage.getItem('prescriptions')) || [];

        // ========== LOGIN FUNCTIONS ==========
        function switchTab(role) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.login-form').forEach(form => form.classList.remove('active'));
            
            document.querySelector(`.tab[onclick*="${role}"]`).classList.add('active');
            document.getElementById(`${role}-login`).classList.add('active');
        }

        function login(role) {
            let userId, password;
            
            switch(role) {
                case 'patient':
                    userId = document.getElementById('patient-email').value;
                    password = document.getElementById('patient-password').value;
                    break;
                case 'doctor':
                    userId = document.getElementById('doctor-id').value;
                    password = document.getElementById('doctor-password').value;
                    break;
                case 'admin':
                    userId = document.getElementById('admin-id').value;
                    password = document.getElementById('admin-password').value;
                    break;
            }
            
            if (!userId || !password) {
                alert('Please enter both ID and password');
                return;
            }
            
            currentUser = {
                role: role,
                name: role === 'patient' ? 'Patient User' : 
                      role === 'doctor' ? 'Dr. Arjun Kumar' : 'Admin User',
                id: userId,
                avatar: role === 'patient' ? 'P' : role === 'doctor' ? 'D' : 'A'
            };
            
            showDashboard();
        }

        function showDashboard() {
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            
            // Update user info
            document.getElementById('user-name').textContent = currentUser.name;
            document.getElementById('user-role').textContent = currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1);
            document.getElementById('user-avatar').textContent = currentUser.avatar;
            
            // Hide/show menu items based on role
            const patientsMenu = document.getElementById('patients-menu');
            const prescriptionMenu = document.getElementById('prescription-menu');
            const manageAppointmentsTab = document.getElementById('manage-appointments-tab');
            
            if (currentUser.role === 'patient') {
                patientsMenu.style.display = 'none';
                prescriptionMenu.style.display = 'flex';
                if (manageAppointmentsTab) manageAppointmentsTab.style.display = 'none';
            } else {
                patientsMenu.style.display = 'flex';
                prescriptionMenu.style.display = 'none';
                if (manageAppointmentsTab) manageAppointmentsTab.style.display = 'inline-block';
            }
            
            // Load dashboard
            loadDashboardStats();
            updateCartCount();
            
            // Show dashboard home
            showPage('dashboard-home');
        }

        function logout() {
            currentUser = null;
            cart = [];
            appointments = [];
            prescriptions = [];
            localStorage.removeItem('cart');
            localStorage.removeItem('appointments');
            localStorage.removeItem('prescriptions');
            document.getElementById('login-container').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';
            
            // Reset login forms
            document.querySelectorAll('input').forEach(input => input.value = '');
            switchTab('patient');
        }

        // ========== PAGE NAVIGATION ==========
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            // Deactivate all menu items
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Activate corresponding menu item
            document.querySelectorAll('.menu-item').forEach(item => {
                if (item.getAttribute('onclick') && item.getAttribute('onclick').includes(pageId)) {
                    item.classList.add('active');
                }
            });
            
            // Load page data
            loadPageData(pageId);
        }

        function loadPageData(pageId) {
            switch(pageId) {
                case 'dashboard-home':
                    loadDashboardStats();
                    break;
                case 'doctors':
                    loadDoctorsList();
                    break;
                case 'book-appointment':
                    loadAppointmentPage();
                    break;
                case 'pharmacy':
                    loadMedicinesList();
                    break;
                case 'chatbot':
                    // Chatbot is already loaded
                    break;
                case 'appointment-mgmt':
                    loadAppointments();
                    break;
                case 'prescription-history':
                    loadPrescriptions();
                    break;
                case 'patients':
                    loadPatientsList();
                    break;
            }
        }

        // ========== DASHBOARD FUNCTIONS ==========
        function loadDashboardStats() {
            let statsHTML = '';
            
            if (currentUser.role === 'patient') {
                const pendingApps = appointments.filter(a => a.patientId === currentUser.id && a.status === 'requested').length;
                const approvedApps = appointments.filter(a => a.patientId === currentUser.id && a.status === 'approved').length;
                
                statsHTML = `
                    <div class="stat-card">
                        <i class="fas fa-calendar-check"></i>
                        <h3>${approvedApps}</h3>
                        <p>Approved Appointments</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-clock"></i>
                        <h3>${pendingApps}</h3>
                        <p>Pending Appointments</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-pills"></i>
                        <h3>${cart.length}</h3>
                        <p>Medicines in Cart</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-prescription"></i>
                        <h3>${prescriptions.filter(p => p.patientId === currentUser.id).length}</h3>
                        <p>Active Prescriptions</p>
                    </div>
                `;
            } else if (currentUser.role === 'doctor') {
                const todaysApps = appointments.filter(a => a.doctorId == 1 && a.status === 'approved').length;
                const pendingApps = appointments.filter(a => a.doctorId == 1 && a.status === 'requested').length;
                
                statsHTML = `
                    <div class="stat-card">
                        <i class="fas fa-user-injured"></i>
                        <h3>${todaysApps}</h3>
                        <p>Today's Appointments</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-clock"></i>
                        <h3>${pendingApps}</h3>
                        <p>Pending Approvals</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-prescription"></i>
                        <h3>12</h3>
                        <p>Prescriptions Today</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-star"></i>
                        <h3>4.9</h3>
                        <p>Patient Rating</p>
                    </div>
                `;
            } else {
                const totalApps = appointments.length;
                const pendingApps = appointments.filter(a => a.status === 'requested').length;
                
                statsHTML = `
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <h3>1,245</h3>
                        <p>Total Patients</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-user-md"></i>
                        <h3>10</h3>
                        <p>Active Doctors</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-calendar-alt"></i>
                        <h3>${totalApps}</h3>
                        <p>Total Appointments</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-clock"></i>
                        <h3>${pendingApps}</h3>
                        <p>Pending Approvals</p>
                    </div>
                `;
            }
            
            document.getElementById('dashboard-stats').innerHTML = statsHTML;
        }

        // ========== DOCTORS FUNCTIONS ==========
        function loadDoctorsList() {
            let html = '';
            doctors.forEach(doctor => {
                // Calculate available slots
                const availableSlots = Object.values(doctor.availability).filter(slot => slot).length;
                const totalSlots = Object.keys(doctor.availability).length;
                const availabilityStatus = availableSlots > 0 ? 'available' : 'unavailable';
                
                html += `
                    <div class="doctor-card">
                        <div class="doctor-header">
                            <div class="doctor-avatar">${doctor.name.split(' ').map(n => n[0]).join('')}</div>
                            <div>
                                <h3>${doctor.name}</h3>
                                <div class="specialty-badge">${doctor.specialty}</div>
                                <span class="availability-badge ${availabilityStatus}">
                                    <i class="fas fa-${availabilityStatus === 'available' ? 'check-circle' : 'times-circle'}"></i>
                                    ${availableSlots}/${totalSlots} slots available
                                </span>
                            </div>
                        </div>
                        <p><strong>Experience:</strong> ${doctor.experience}</p>
                        <p><strong>Treats:</strong> ${doctor.treats}</p>
                        <p><strong>Working Days:</strong> ${doctor.workingDays.join(', ')}</p>
                        <p><strong>Consultation Fee:</strong> â‚¹${doctor.fee}</p>
                        ${currentUser.role === 'patient' ? `<button class="book-btn" onclick="bookDoctor(${doctor.id})">Book Appointment</button>` : ''}
                    </div>
                `;
            });
            document.getElementById('doctors-list').innerHTML = html;
        }

        function searchDoctors() {
            const searchTerm = document.getElementById('doctor-search').value.toLowerCase();
            const doctorCards = document.querySelectorAll('#doctors-list .doctor-card');
            
            doctorCards.forEach(card => {
                const doctorName = card.querySelector('h3').textContent.toLowerCase();
                const specialty = card.querySelector('.specialty-badge').textContent.toLowerCase();
                
                if (doctorName.includes(searchTerm) || specialty.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function bookDoctor(doctorId) {
            showPage('book-appointment');
            // Set the doctor in appointment form
            setTimeout(() => {
                document.getElementById('appointment-doctor').value = doctorId;
                updateConsultationFee();
                loadDoctorAvailability();
            }, 100);
        }

        // NEW: Load doctor availability time slots
        function loadDoctorAvailability() {
            const doctorId = document.getElementById('appointment-doctor').value;
            if (!doctorId) {
                document.getElementById('doctor-availability-section').style.display = 'none';
                return;
            }
            
            const doctor = doctors.find(d => d.id == doctorId);
            if (!doctor) return;
            
            const container = document.getElementById('time-slots-container');
            container.innerHTML = '';
            
            Object.entries(doctor.availability).forEach(([time, available]) => {
                const slot = document.createElement('div');
                slot.className = `time-slot ${available ? '' : 'unavailable'}`;
                slot.textContent = time;
                slot.onclick = available ? function() {
                    // Remove selected class from all slots
                    document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
                    // Add selected class to clicked slot
                    this.classList.add('selected');
                    // Update appointment time dropdown
                    document.getElementById('appointment-time').value = time;
                } : null;
                
                container.appendChild(slot);
            });
            
            document.getElementById('doctor-availability-section').style.display = 'block';
        }

        // ========== APPOINTMENT BOOKING FUNCTIONS ==========
        function loadAppointmentPage() {
            // Load doctors in dropdown
            const doctorSelect = document.getElementById('appointment-doctor');
            doctorSelect.innerHTML = '<option value="">-- Choose a specialist --</option>';
            doctors.forEach(doctor => {
                doctorSelect.innerHTML += `<option value="${doctor.id}">${doctor.name} - ${doctor.specialty}</option>`;
            });
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('appointment-date').min = today;
            
            // Setup symptom cards
            document.querySelectorAll('.symptom-card').forEach(card => {
                card.addEventListener('click', function() {
                    this.classList.toggle('selected');
                    const symptom = this.dataset.symptom;
                    if (this.classList.contains('selected')) {
                        selectedSymptoms.push(symptom);
                    } else {
                        selectedSymptoms = selectedSymptoms.filter(s => s !== symptom);
                    }
                });
            });
            
            // Clear previous recommendations
            document.getElementById('doctor-recommendation').innerHTML = '';
        }

        function findDoctorBySymptoms() {
            const additionalSymptoms = document.getElementById('additional-symptoms').value;
            const recommendationDiv = document.getElementById('doctor-recommendation');
            
            if (selectedSymptoms.length === 0 && !additionalSymptoms) {
                alert('Please select symptoms or describe your condition');
                return;
            }
            
            // Symptom to doctor mapping
            const symptomMapping = {
                'Fever': ['General Physician', 'Infectious Disease Specialist'],
                'Headache': ['Neurologist', 'General Physician'],
                'Cough': ['ENT Specialist', 'Pulmonologist'],
                'Cold': ['ENT Specialist', 'General Physician'],
                'Dizziness': ['Neurologist', 'Cardiologist', 'Emergency Medicine'],
                'Vomiting': ['Gastroenterologist', 'Gynecologist', 'Emergency Medicine'],
                'Chest Pain': ['Cardiologist'],
                'Joint Pain': ['Orthopedic']
            };
            
            let matchedSpecialties = [];
            
            // Find matching specialties for symptoms
            selectedSymptoms.forEach(symptom => {
                if (symptomMapping[symptom]) {
                    matchedSpecialties = [...matchedSpecialties, ...symptomMapping[symptom]];
                }
            });
            
            // Check additional symptoms text
            if (additionalSymptoms) {
                const text = additionalSymptoms.toLowerCase();
                if (text.includes('fever')) matchedSpecialties.push('General Physician', 'Infectious Disease Specialist');
                if (text.includes('headache')) matchedSpecialties.push('Neurologist', 'General Physician');
                if (text.includes('cough') || text.includes('cold')) matchedSpecialties.push('ENT Specialist', 'Pulmonologist');
                if (text.includes('dizziness')) matchedSpecialties.push('Neurologist', 'Cardiologist');
                if (text.includes('vomit') || text.includes('nausea')) matchedSpecialties.push('Gastroenterologist');
                if (text.includes('chest')) matchedSpecialties.push('Cardiologist');
                if (text.includes('joint') || text.includes('pain')) matchedSpecialties.push('Orthopedic');
            }
            
            // Remove duplicates
            matchedSpecialties = [...new Set(matchedSpecialties)];
            
            if (matchedSpecialties.length === 0) {
                matchedSpecialties = ['General Physician'];
            }
            
            // Find matching doctors
            const matchingDoctors = doctors.filter(doctor => 
                matchedSpecialties.includes(doctor.specialty)
            );
            
            let html = `<h3 style="margin-bottom: 20px;"><i class="fas fa-user-md"></i> Recommended Specialists</h3>`;
            
            if (matchingDoctors.length > 0) {
                matchingDoctors.forEach(doctor => {
                    const availableSlots = Object.values(doctor.availability).filter(slot => slot).length;
                    
                    html += `
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #1a2980;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h4 style="margin-bottom: 5px;">${doctor.name}</h4>
                                    <div style="color: #666; font-size: 0.9rem;">${doctor.specialty}</div>
                                    <div style="color: #666; font-size: 0.9rem; margin-top: 5px;">Available slots: ${availableSlots}</div>
                                </div>
                                <button class="btn" onclick="bookDoctor(${doctor.id})" style="padding: 10px 20px;">
                                    <i class="fas fa-calendar-plus"></i> Book Now
                                </button>
                            </div>
                        </div>
                    `;
                });
            } else {
                html += '<p>No doctors available for these symptoms. Please consult a General Physician.</p>';
            }
            
            recommendationDiv.innerHTML = html;
        }

        function updateConsultationFee() {
            const doctorId = document.getElementById('appointment-doctor').value;
            const doctor = doctors.find(d => d.id == doctorId);
            if (doctor) {
                document.getElementById('consultation-fee').textContent = doctor.fee;
            }
        }

        function loadAvailableSlots() {
            const timeSelect = document.getElementById('appointment-time');
            timeSelect.innerHTML = '<option value="">-- Select Time --</option>';
            
            const slots = ['09:00 AM', '10:30 AM', '02:00 PM', '04:30 PM'];
            slots.forEach(slot => {
                timeSelect.innerHTML += `<option value="${slot}">${slot}</option>`;
            });
        }

        function bookAppointment() {
            const doctorId = document.getElementById('appointment-doctor').value;
            const date = document.getElementById('appointment-date').value;
            const time = document.getElementById('appointment-time').value;
            const symptoms = document.getElementById('appointment-symptoms').value;
            
            if (!doctorId || !date || !time || !symptoms) {
                alert('Please fill in all appointment details');
                return;
            }
            
            const doctor = doctors.find(d => d.id == doctorId);
            const consultationType = document.querySelector('input[name="consultation-type"]:checked').value;
            
            // Create appointment with workflow status
            const appointment = {
                id: appointments.length + 1,
                patientId: currentUser.id,
                patientName: currentUser.name,
                doctorId: doctor.id,
                doctorName: doctor.name,
                date: date,
                time: time,
                symptoms: symptoms,
                type: consultationType,
                fee: doctor.fee,
                status: 'requested', // Initial status
                createdAt: new Date().toISOString()
            };
            
            appointments.push(appointment);
            localStorage.setItem('appointments', JSON.stringify(appointments));
            
            alert(`Appointment requested successfully!\n\nStatus: Pending Approval\nDoctor: ${doctor.name}\nDate: ${date}\nTime: ${time}\n\nWe will notify you once approved.`);
            
            // Reset form
            document.getElementById('appointment-symptoms').value = '';
            showPage('appointment-mgmt');
        }

        // ========== PHARMACY FUNCTIONS WITH STOCK INDICATORS ==========
        function loadMedicinesList() {
            let html = '';
            medicines.forEach(medicine => {
                // Determine stock status
                let stockStatus = '';
                let stockClass = '';
                let stockIndicator = '';
                
                if (medicine.stock === 0) {
                    stockStatus = 'Out of Stock';
                    stockClass = 'out-of-stock';
                    stockIndicator = '<span class="stock-indicator stock-out"></span>';
                } else if (medicine.stock <= medicine.minStock) {
                    stockStatus = `Low Stock (${medicine.stock} left)`;
                    stockClass = 'low-stock';
                    stockIndicator = '<span class="stock-indicator stock-low"></span>';
                } else {
                    stockStatus = `In Stock (${medicine.stock})`;
                    stockClass = 'in-stock';
                    stockIndicator = '<span class="stock-indicator stock-in"></span>';
                }
                
                html += `
                    <div class="medicine-card">
                        <div class="medicine-header">
                            <div class="medicine-icon">
                                <i class="fas fa-pills"></i>
                            </div>
                            <h3>${medicine.name}</h3>
                            <div class="category-badge">${medicine.category}</div>
                            ${medicine.prescription ? '<span class="prescription-badge">Prescription Required</span>' : ''}
                        </div>
                        <p><strong>Used For:</strong> ${medicine.usedFor}</p>
                        <p><strong>Type:</strong> ${medicine.type}</p>
                        <div style="margin: 10px 0;">
                            ${stockIndicator}
                            <span class="${stockClass}">${stockStatus}</span>
                        </div>
                        <div class="price">â‚¹${medicine.price}</div>
                        <button class="buy-btn" onclick="addToCart(${medicine.id})" ${medicine.stock === 0 ? 'disabled style="opacity: 0.5; cursor: not-allowed;"' : ''}>
                            <i class="fas fa-cart-plus"></i> ${medicine.stock === 0 ? 'Out of Stock' : 'Add to Cart'}
                        </button>
                    </div>
                `;
            });
            document.getElementById('medicines-list').innerHTML = html;
        }

        function searchMedicines() {
            const searchTerm = document.getElementById('medicine-search').value.toLowerCase();
            const medicineCards = document.querySelectorAll('#medicines-list .medicine-card');
            
            medicineCards.forEach(card => {
                const medicineName = card.querySelector('h3').textContent.toLowerCase();
                const usedFor = card.querySelector('p').textContent.toLowerCase();
                
                if (medicineName.includes(searchTerm) || usedFor.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function addToCart(medicineId) {
            const medicine = medicines.find(m => m.id === medicineId);
            if (!medicine) return;
            
            if (medicine.stock === 0) {
                alert('This medicine is currently out of stock.');
                return;
            }
            
            if (medicine.prescription) {
                if (!confirm('This medicine requires a doctor\'s prescription. Do you have a valid prescription?')) {
                    alert('Please consult a doctor and get a prescription before ordering this medicine.');
                    return;
                }
            }
            
            const existingItem = cart.find(item => item.id === medicineId);
            
            if (existingItem) {
                if (existingItem.quantity >= medicine.stock) {
                    alert(`Only ${medicine.stock} units available in stock.`);
                    return;
                }
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: medicine.id,
                    name: medicine.name,
                    price: medicine.price,
                    quantity: 1,
                    prescription: medicine.prescription
                });
            }
            
            updateCartCount();
            alert(`${medicine.name} added to cart!`);
            saveCart();
        }

        function updateCartCount() {
            const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
            document.getElementById('cart-count').textContent = totalItems;
            document.getElementById('cart-count-header').textContent = totalItems;
        }

        function viewCart() {
            if (cart.length === 0) {
                alert('Your cart is empty!');
                return;
            }
            
            const cartItemsDiv = document.getElementById('cart-items');
            const summaryDiv = document.getElementById('cart-summary');
            
            let cartHTML = '';
            let subtotal = 0;
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                
                cartHTML += `
                    <div class="cart-item">
                        <div style="flex: 1;">
                            <h4 style="margin-bottom: 5px;">${item.name}</h4>
                            <p style="color: #666; font-size: 0.9rem;">â‚¹${item.price} each</p>
                        </div>
                        <div class="quantity-controls">
                            <button class="qty-btn" onclick="updateCartQuantity(${item.id}, -1)">-</button>
                            <span style="font-weight: bold; min-width: 30px; text-align: center;">${item.quantity}</span>
                            <button class="qty-btn" onclick="updateCartQuantity(${item.id}, 1)">+</button>
                        </div>
                        <div style="font-weight: bold; color: #1a2980; min-width: 80px; text-align: right;">
                            â‚¹${itemTotal}
                        </div>
                    </div>
                `;
            });
            
            const delivery = 50;
            const gst = subtotal * 0.05;
            const total = subtotal + delivery + gst;
            
            const summaryHTML = `
                <div style="border-top: 2px solid #eee; padding-top: 20px; margin-top: 20px;">
                    <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                        <span>Subtotal</span>
                        <span>â‚¹${subtotal}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                        <span>Delivery Charge</span>
                        <span>â‚¹${delivery}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                        <span>GST (5%)</span>
                        <span>â‚¹${gst.toFixed(2)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 1.2rem; margin: 20px 0; padding-top: 20px; border-top: 2px solid #1a2980;">
                        <span>Total</span>
                        <span>â‚¹${total.toFixed(2)}</span>
                    </div>
                </div>
            `;
            
            cartItemsDiv.innerHTML = cartHTML;
            summaryDiv.innerHTML = summaryHTML;
            document.getElementById('cart-modal').classList.add('active');
        }

        function updateCartQuantity(medicineId, change) {
            const itemIndex = cart.findIndex(item => item.id === medicineId);
            
            if (itemIndex !== -1) {
                cart[itemIndex].quantity += change;
                
                if (cart[itemIndex].quantity <= 0) {
                    cart.splice(itemIndex, 1);
                }
            }
            
            updateCartCount();
            saveCart();
            
            if (document.getElementById('cart-modal').classList.contains('active')) {
                viewCart();
            }
        }

        function closeCart() {
            document.getElementById('cart-modal').classList.remove('active');
        }

        function checkout() {
            if (cart.length === 0) {
                alert('Your cart is empty!');
                return;
            }
            
            // Check stock before checkout
            for (const item of cart) {
                const medicine = medicines.find(m => m.id === item.id);
                if (medicine && item.quantity > medicine.stock) {
                    alert(`Insufficient stock for ${medicine.name}. Only ${medicine.stock} units available.`);
                    return;
                }
            }
            
            alert('Order placed successfully!\n\nMedicines will be delivered within 2 hours.\nPlease keep your doctor\'s prescription ready for delivery verification.');
            
            // Update stock (in real system, this would be on server)
            cart.forEach(item => {
                const medicineIndex = medicines.findIndex(m => m.id === item.id);
                if (medicineIndex !== -1) {
                    medicines[medicineIndex].stock -= item.quantity;
                }
            });
            
            cart = [];
            updateCartCount();
            saveCart();
            closeCart();
            loadMedicinesList(); // Refresh medicine list
        }

        function uploadPrescription() {
            alert('Please upload your prescription during checkout.\n\nSupported formats: JPG, PNG, PDF\nMaximum size: 5MB');
        }

        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(cart));
        }

        // ========== CHATBOT FUNCTIONS ==========
        function sendChatbotMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            addChatMessage(message, 'user');
            input.value = '';
            
            setTimeout(() => {
                const response = generateAIResponse(message);
                addChatMessage(response, 'bot');
            }, 1000);
        }

        function handleChatEnter(event) {
            if (event.key === 'Enter') {
                sendChatbotMessage();
            }
        }

        function askQuickQuestion(question) {
            document.getElementById('chat-input').value = question;
            sendChatbotMessage();
        }

        function addChatMessage(text, sender) {
            const messagesDiv = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-content">${text}</div>
                <div class="message-time">${time}</div>
            `;
            
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function generateAIResponse(userMessage) {
            const message = userMessage.toLowerCase();
            let response = '';
            
            if (message.includes('fever') && message.includes('headache')) {
                response = `ðŸ¤’ Based on your symptoms of <strong>fever and headache</strong>:
                <br><br>
                <strong>Possible Causes:</strong>
                â€¢ Viral infection (common cold, flu)<br>
                â€¢ Bacterial infection<br>
                â€¢ Dehydration<br>
                â€¢ Sinusitis<br>
                <br>
                <strong>Immediate Care:</strong>
                â€¢ Take Paracetamol 500mg every 6-8 hours<br>
                â€¢ Drink plenty of fluids (water, ORS)<br>
                â€¢ Rest and monitor temperature every 4 hours<br>
                â€¢ Cold compress for headache relief<br>
                <br>
                <strong>Recommended Doctor:</strong> General Physician (Dr. Arjun Kumar)<br>
                <strong>Suitable Medicines:</strong> Paracetamol, Ibuprofen<br>
                <strong>Emergency signs:</strong> Fever above 103Â°F, severe headache with vomiting, stiff neck`;
                
            } else if (message.includes('cough') || message.includes('cold')) {
                response = `ðŸ˜· For <strong>cough and cold</strong> symptoms:
                <br><br>
                <strong>Home Remedies:</strong>
                â€¢ Warm water with honey and lemon<br>
                â€¢ Steam inhalation 2-3 times daily<br>
                â€¢ Salt water gargle for throat pain<br>
                â€¢ Use humidifier at night<br>
                <br>
                <strong>Medications (if needed):</strong>
                â€¢ Cough Syrup as per symptoms<br>
                â€¢ Cetirizine for runny nose<br>
                â€¢ Paracetamol for fever<br>
                â€¢ Vitamin C supplements<br>
                <br>
                <strong>Recommended Doctor:</strong> ENT Specialist (Dr. Priya Nair)<br>
                <strong>Suitable Medicines:</strong> Cough Syrup, Cetirizine<br>
                <strong>Seek medical help if:</strong> Breathing difficulties, yellow/green mucus, symptoms worsen after 5 days`;
                
            } else if (message.includes('stomach') || message.includes('nausea') || message.includes('vomit')) {
                response = `ðŸ¤¢ For <strong>stomach issues</strong>:
                <br><br>
                <strong>Immediate Relief:</strong>
                â€¢ Ondansetron 4mg for nausea<br>
                â€¢ Domperidone for vomiting<br>
                â€¢ Drink small sips of water/ORS<br>
                â€¢ BRAT diet (Banana, Rice, Apple, Toast)<br>
                <br>
                <strong>Avoid:</strong>
                â€¢ Spicy/oily food<br>
                â€¢ Dairy products<br>
                â€¢ Caffeine and alcohol<br>
                â€¢ Raw vegetables<br>
                <br>
                <strong>Recommended Doctor:</strong> Gastroenterologist (Dr. Sanjay Verma)<br>
                <strong>Suitable Medicines:</strong> Ondansetron, Domperidone, Pantoprazole<br>
                <strong>Emergency:</strong> Severe abdominal pain, blood in vomit, dehydration signs`;
                
            } else if (message.includes('dizziness') || message.includes('vertigo')) {
                response = `ðŸ’« For <strong>dizziness</strong>:
                <br><br>
                <strong>Immediate Actions:</strong>
                â€¢ Sit or lie down immediately<br>
                â€¢ Drink water<br>
                â€¢ Avoid sudden movements<br>
                â€¢ Focus on a fixed point<br>
                <br>
                <strong>Medication (if prescribed):</strong>
                â€¢ Vertin 16mg<br>
                â€¢ Avoid driving or operating machinery<br>
                <br>
                <strong>Recommended Doctor:</strong> Neurologist (Dr. Raghav Sharma)<br>
                <strong>Suitable Medicines:</strong> Vertin, Diazepam (as prescribed)<br>
                <strong>Emergency signs:</strong> Chest pain, difficulty speaking, vision changes, loss of consciousness`;
                
            } else if (message.includes('medicine') || message.includes('pill') || message.includes('tablet')) {
                response = `ðŸ’Š <strong>Medicine Information</strong>
                <br><br>
                I can provide information about common medicines. For specific queries:
                <br><br>
                â€¢ <strong>Dosage:</strong> Always follow doctor's prescription<br>
                â€¢ <strong>Side Effects:</strong> Check medicine leaflet or consult pharmacist<br>
                â€¢ <strong>Interactions:</strong> Inform doctor about all medicines you're taking<br>
                â€¢ <strong>Storage:</strong> Store in cool, dry place away from sunlight<br>
                <br>
                <strong>Important:</strong> Never self-medicate without doctor's advice.<br>
                Visit our Pharmacy section for medicine details.`;
                
            } else {
                response = `ðŸ¤– I understand you're asking about <strong>"${userMessage}"</strong>.
                <br><br>
                As an AI health assistant, I can help with:
                <br><br>
                â€¢ Symptom analysis and doctor recommendations<br>
                â€¢ General health information<br>
                â€¢ Medicine guidance<br>
                â€¢ First aid advice<br>
                â€¢ Preventive care tips<br>
                <br>
                For accurate diagnosis and treatment, please consult a doctor.<br>
                For emergencies, call <strong>108</strong> immediately.`;
            }
            
            return response;
        }

        // ========== NEW: APPOINTMENT MANAGEMENT FUNCTIONS ==========
        function showAppointmentTab(tabName) {
            // Hide all tab contents
            document.getElementById('my-appointments-content').style.display = 'none';
            document.getElementById('manage-appointments-content').style.display = 'none';
            
            // Remove active class from all tabs
            document.querySelectorAll('.sub-tab').forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab and add active class
            if (tabName === 'my-appointments') {
                document.getElementById('my-appointments-content').style.display = 'block';
                document.querySelector('.sub-tab[onclick*="my-appointments"]').classList.add('active');
                loadAppointments();
            } else {
                document.getElementById('manage-appointments-content').style.display = 'block';
                document.querySelector('.sub-tab[onclick*="manage-appointments"]').classList.add('active');
                loadAllAppointments();
            }
        }

        function loadAppointments() {
            let userAppointments = [];
            
            if (currentUser.role === 'patient') {
                userAppointments = appointments.filter(a => a.patientId === currentUser.id);
            } else if (currentUser.role === 'doctor') {
                userAppointments = appointments.filter(a => a.doctorId == 1); // Assuming doctor ID 1
            } else {
                userAppointments = appointments; // Admin sees all
            }
            
            if (userAppointments.length === 0) {
                document.getElementById('appointments-list').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-calendar-times" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <h3>No Appointments Found</h3>
                        <p>You don't have any appointments yet.</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            userAppointments.forEach(appointment => {
                const statusClass = `status-${appointment.status}`;
                const statusText = appointment.status.charAt(0).toUpperCase() + appointment.status.slice(1);
                
                html += `
                    <div class="appointment-card">
                        <div class="appointment-header">
                            <div>
                                <h3 style="margin-bottom: 5px;">Appointment #${appointment.id}</h3>
                                <p style="color: #666;">${appointment.doctorName} â€¢ ${appointment.date} at ${appointment.time}</p>
                            </div>
                            <div>
                                <span class="status-badge ${statusClass}">${statusText}</span>
                            </div>
                        </div>
                        
                        <p><strong>Symptoms:</strong> ${appointment.symptoms}</p>
                        <p><strong>Type:</strong> ${appointment.type === 'clinic' ? 'In-Clinic' : 'Video Call'}</p>
                        <p><strong>Fee:</strong> â‚¹${appointment.fee}</p>
                        
                        <div class="appointment-actions">
                            ${currentUser.role === 'patient' ? `
                                <button class="action-btn" onclick="cancelAppointment(${appointment.id})" ${appointment.status !== 'requested' ? 'disabled style="opacity: 0.5;"' : ''}>
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                            ` : ''}
                            
                            ${(currentUser.role === 'doctor' || currentUser.role === 'admin') && appointment.status === 'requested' ? `
                                <button class="action-btn secondary" onclick="updateAppointmentStatus(${appointment.id}, 'approved')">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="action-btn" onclick="updateAppointmentStatus(${appointment.id}, 'cancelled')">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                            ` : ''}
                            
                            ${appointment.status === 'approved' ? `
                                <button class="action-btn secondary" onclick="updateAppointmentStatus(${appointment.id}, 'completed')">
                                    <i class="fas fa-check-double"></i> Mark Complete
                                </button>
                            ` : ''}
                            
                            <button class="action-btn" onclick="printAppointment(${appointment.id})">
                                <i class="fas fa-print"></i> Print
                            </button>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('appointments-list').innerHTML = html;
        }

        function loadAllAppointments() {
            if (appointments.length === 0) {
                document.getElementById('all-appointments-list').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-calendar-times" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <h3>No Appointments Found</h3>
                        <p>There are no appointments in the system yet.</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div style="overflow-x: auto;">
                    <table class="patients-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Patient</th>
                                <th>Doctor</th>
                                <th>Date & Time</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            appointments.forEach(appointment => {
                const statusClass = `status-${appointment.status}`;
                const statusText = appointment.status.charAt(0).toUpperCase() + appointment.status.slice(1);
                
                html += `
                    <tr>
                        <td>#${appointment.id}</td>
                        <td>${appointment.patientName}</td>
                        <td>${appointment.doctorName}</td>
                        <td>${appointment.date} ${appointment.time}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            ${appointment.status === 'requested' ? `
                                <button class="action-btn secondary" onclick="updateAppointmentStatus(${appointment.id}, 'approved')">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="action-btn" onclick="updateAppointmentStatus(${appointment.id}, 'cancelled')">
                                    <i class="fas fa-times"></i>
                                </button>
                            ` : ''}
                            <button class="action-btn" onclick="viewAppointmentDetails(${appointment.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `</tbody></table></div>`;
            document.getElementById('all-appointments-list').innerHTML = html;
        }

        function updateAppointmentStatus(appointmentId, newStatus) {
            const appointmentIndex = appointments.findIndex(a => a.id === appointmentId);
            
            if (appointmentIndex !== -1) {
                appointments[appointmentIndex].status = newStatus;
                appointments[appointmentIndex].updatedAt = new Date().toISOString();
                
                // If completing appointment, create a prescription
                if (newStatus === 'completed') {
                    createPrescription(appointments[appointmentIndex]);
                }
                
                localStorage.setItem('appointments', JSON.stringify(appointments));
                
                alert(`Appointment ${newStatus} successfully!`);
                loadAppointments();
                loadAllAppointments();
                loadDashboardStats();
            }
        }

        function cancelAppointment(appointmentId) {
            if (confirm('Are you sure you want to cancel this appointment?')) {
                updateAppointmentStatus(appointmentId, 'cancelled');
            }
        }

        function viewAppointmentDetails(appointmentId) {
            const appointment = appointments.find(a => a.id === appointmentId);
            if (appointment) {
                alert(`Appointment Details:\n\nID: #${appointment.id}\nPatient: ${appointment.patientName}\nDoctor: ${appointment.doctorName}\nDate: ${appointment.date}\nTime: ${appointment.time}\nSymptoms: ${appointment.symptoms}\nStatus: ${appointment.status}\nType: ${appointment.type === 'clinic' ? 'In-Clinic' : 'Video Call'}\nFee: â‚¹${appointment.fee}`);
            }
        }

        // ========== NEW: PRESCRIPTION FUNCTIONS ==========
        function createPrescription(appointment) {
            const prescription = {
                id: prescriptions.length + 1,
                appointmentId: appointment.id,
                patientId: appointment.patientId,
                patientName: appointment.patientName,
                doctorId: appointment.doctorId,
                doctorName: appointment.doctorName,
                date: new Date().toISOString().split('T')[0],
                medicines: [
                    { name: "Paracetamol 500mg", dosage: "1 tablet every 6 hours", duration: "3 days" },
                    { name: "Cetirizine 10mg", dosage: "1 tablet at night", duration: "5 days" }
                ],
                instructions: "Take after meals. Complete the full course. Avoid alcohol.",
                followUp: "Follow up after 5 days if symptoms persist."
            };
            
            prescriptions.push(prescription);
            localStorage.setItem('prescriptions', JSON.stringify(prescriptions));
            
            // Also add sample prescriptions for demo
            if (prescriptions.length === 1) {
                const samplePrescription = {
                    id: 2,
                    appointmentId: 0,
                    patientId: currentUser.id,
                    patientName: currentUser.name,
                    doctorId: 1,
                    doctorName: "Dr. Arjun Kumar",
                    date: "2024-02-10",
                    medicines: [
                        { name: "Amoxicillin 250mg", dosage: "1 capsule every 8 hours", duration: "7 days" },
                        { name: "Pantoprazole 40mg", dosage: "1 tablet before breakfast", duration: "14 days" }
                    ],
                    instructions: "Take antibiotic with plenty of water. Complete full course.",
                    followUp: "Schedule follow-up after 7 days."
                };
                prescriptions.push(samplePrescription);
                localStorage.setItem('prescriptions', JSON.stringify(prescriptions));
            }
        }

        function loadPrescriptions() {
            let userPrescriptions = [];
            
            if (currentUser.role === 'patient') {
                userPrescriptions = prescriptions.filter(p => p.patientId === currentUser.id);
            } else if (currentUser.role === 'doctor') {
                userPrescriptions = prescriptions.filter(p => p.doctorId == 1);
            } else {
                userPrescriptions = prescriptions;
            }
            
            if (userPrescriptions.length === 0) {
                document.getElementById('prescriptions-list').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-file-prescription" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <h3>No Prescriptions Found</h3>
                        <p>You don't have any prescriptions yet.</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            userPrescriptions.forEach(prescription => {
                let medicinesHtml = '';
                prescription.medicines.forEach(med => {
                    medicinesHtml += `
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin: 5px 0;">
                            <strong>${med.name}</strong><br>
                            <small>Dosage: ${med.dosage} for ${med.duration}</small>
                        </div>
                    `;
                });
                
                html += `
                    <div class="prescription-card">
                        <div class="prescription-header">
                            <div>
                                <h3 style="margin-bottom: 5px;">Prescription #${prescription.id}</h3>
                                <p style="color: #666;">Dr. ${prescription.doctorName} â€¢ ${prescription.date}</p>
                            </div>
                            <div>
                                <button class="action-btn" onclick="printSinglePrescription(${prescription.id})">
                                    <i class="fas fa-print"></i> Print
                                </button>
                            </div>
                        </div>
                        
                        <p><strong>Patient:</strong> ${prescription.patientName}</p>
                        
                        <div style="margin: 15px 0;">
                            <strong>Medications:</strong>
                            ${medicinesHtml}
                        </div>
                        
                        <p><strong>Instructions:</strong> ${prescription.instructions}</p>
                        <p><strong>Follow-up:</strong> ${prescription.followUp}</p>
                    </div>
                `;
            });
            
            document.getElementById('prescriptions-list').innerHTML = html;
        }

        // ========== NEW: EXPORT & PRINT FUNCTIONS ==========
        function exportAppointments() {
            let userAppointments = [];
            
            if (currentUser.role === 'patient') {
                userAppointments = appointments.filter(a => a.patientId === currentUser.id);
            } else {
                userAppointments = appointments;
            }
            
            if (userAppointments.length === 0) {
                alert('No appointments to export');
                return;
            }
            
            // Create CSV content
            let csv = 'ID,Patient,Doctor,Date,Time,Status,Type,Fee\n';
            userAppointments.forEach(app => {
                csv += `${app.id},${app.patientName},${app.doctorName},${app.date},${app.time},${app.status},${app.type},${app.fee}\n`;
            });
            
            // Create download link
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `appointments_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            alert('Appointments exported successfully!');
        }

        function printAppointments() {
            let userAppointments = [];
            
            if (currentUser.role === 'patient') {
                userAppointments = appointments.filter(a => a.patientId === currentUser.id);
            } else {
                userAppointments = appointments;
            }
            
            if (userAppointments.length === 0) {
                alert('No appointments to print');
                return;
            }
            
            let printHTML = `
                <div class="print-content">
                    <h2>MediCare Hospital - Appointments Report</h2>
                    <p>Generated on: ${new Date().toLocaleDateString()}</p>
                    <p>User: ${currentUser.name} (${currentUser.role})</p>
                    <hr>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                        <thead>
                            <tr style="background: #f8f9fa;">
                                <th style="border: 1px solid #ddd; padding: 8px;">ID</th>
                                <th style="border: 1px solid #ddd; padding: 8px;">Doctor</th>
                                <th style="border: 1px solid #ddd; padding: 8px;">Date</th>
                                <th style="border: 1px solid #ddd; padding: 8px;">Time</th>
                                <th style="border: 1px solid #ddd; padding: 8px;">Status</th>
                                <th style="border: 1px solid #ddd; padding: 8px;">Fee</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            userAppointments.forEach(app => {
                printHTML += `
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 8px;">#${app.id}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">${app.doctorName}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">${app.date}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">${app.time}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">${app.status}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">â‚¹${app.fee}</td>
                    </tr>
                `;
            });
            
            printHTML += `
                        </tbody>
                    </table>
                    <div style="margin-top: 30px; text-align: center;">
                        <p>--- End of Report ---</p>
                    </div>
                </div>
            `;
            
            document.getElementById('print-content').innerHTML = printHTML;
            
            // Trigger print
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Print Appointments</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        @media print {
                            body { margin: 0; }
                        }
                    </style>
                </head>
                <body>
                    ${printHTML}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function printAppointment(appointmentId) {
            const appointment = appointments.find(a => a.id === appointmentId);
            if (!appointment) return;
            
            const printHTML = `
                <div class="print-content">
                    <div style="text-align: center; border-bottom: 2px solid #1a2980; padding-bottom: 20px; margin-bottom: 30px;">
                        <h1 style="color: #1a2980; margin-bottom: 5px;">MediCare Hospital</h1>
                        <p>123 Medical Street, Healthcare City</p>
                        <p>Phone: (123) 456-7890 | Email: info@medicare.com</p>
                    </div>
                    
                    <h2 style="color: #1a2980; border-bottom: 1px solid #eee; padding-bottom: 10px;">Appointment Receipt</h2>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div>
                            <h3 style="color: #666; font-size: 1rem; margin-bottom: 5px;">Appointment Details</h3>
                            <p><strong>ID:</strong> #${appointment.id}</p>
                            <p><strong>Date:</strong> ${appointment.date}</p>
                            <p><strong>Time:</strong> ${appointment.time}</p>
                            <p><strong>Status:</strong> ${appointment.status}</p>
                        </div>
                        <div>
                            <h3 style="color: #666; font-size: 1rem; margin-bottom: 5px;">Consultation Details</h3>
                            <p><strong>Doctor:</strong> ${appointment.doctorName}</p>
                            <p><strong>Patient:</strong> ${appointment.patientName}</p>
                            <p><strong>Type:</strong> ${appointment.type === 'clinic' ? 'In-Clinic' : 'Video Call'}</p>
                            <p><strong>Fee:</strong> â‚¹${appointment.fee}</p>
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <h3 style="color: #666; font-size: 1rem; margin-bottom: 10px;">Symptoms</h3>
                        <p>${appointment.symptoms}</p>
                    </div>
                    
                    <div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #eee;">
                        <div style="text-align: center;">
                            <p>This is a computer-generated receipt. No signature required.</p>
                            <p>Thank you for choosing MediCare Hospital</p>
                            <p>Generated on: ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}</p>
                        </div>
                    </div>
                </div>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Appointment Receipt #${appointment.id}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 40px; }
                        @media print {
                            body { margin: 20px; }
                        }
                    </style>
                </head>
                <body>
                    ${printHTML}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function exportPrescriptions() {
            let userPrescriptions = [];
            
            if (currentUser.role === 'patient') {
                userPrescriptions = prescriptions.filter(p => p.patientId === currentUser.id);
            } else {
                userPrescriptions = prescriptions;
            }
            
            if (userPrescriptions.length === 0) {
                alert('No prescriptions to export');
                return;
            }
            
            // Create CSV content
            let csv = 'ID,Patient,Doctor,Date,Medicines,Instructions\n';
            userPrescriptions.forEach(pres => {
                const medicines = pres.medicines.map(m => m.name).join('; ');
                csv += `${pres.id},${pres.patientName},${pres.doctorName},${pres.date},"${medicines}","${pres.instructions}"\n`;
            });
            
            // Create download link
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `prescriptions_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            alert('Prescriptions exported successfully!');
        }

        function printPrescription() {
            // Print all prescriptions
            printSinglePrescription(null);
        }

        function printSinglePrescription(prescriptionId) {
            let printPrescriptions = [];
            
            if (prescriptionId) {
                const prescription = prescriptions.find(p => p.id === prescriptionId);
                if (prescription) printPrescriptions.push(prescription);
            } else {
                if (currentUser.role === 'patient') {
                    printPrescriptions = prescriptions.filter(p => p.patientId === currentUser.id);
                } else {
                    printPrescriptions = prescriptions;
                }
            }
            
            if (printPrescriptions.length === 0) {
                alert('No prescriptions to print');
                return;
            }
            
            let printHTML = '';
            printPrescriptions.forEach(prescription => {
                let medicinesHtml = '';
                prescription.medicines.forEach(med => {
                    medicinesHtml += `
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">${med.name}</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">${med.dosage}</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">${med.duration}</td>
                        </tr>
                    `;
                });
                
                printHTML += `
                    <div class="print-content" style="page-break-after: always;">
                        <div style="text-align: center; border-bottom: 2px solid #1a2980; padding-bottom: 20px; margin-bottom: 30px;">
                            <h1 style="color: #1a2980; margin-bottom: 5px;">MediCare Hospital</h1>
                            <p>123 Medical Street, Healthcare City</p>
                            <p>Phone: (123) 456-7890 | License: MED123456</p>
                        </div>
                        
                        <h2 style="color: #1a2980; border-bottom: 1px solid #eee; padding-bottom: 10px;">Medical Prescription</h2>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                            <div>
                                <h3 style="color: #666; font-size: 1rem; margin-bottom: 5px;">Patient Details</h3>
                                <p><strong>Name:</strong> ${prescription.patientName}</p>
                                <p><strong>Date:</strong> ${prescription.date}</p>
                                <p><strong>Prescription ID:</strong> #${prescription.id}</p>
                            </div>
                            <div>
                                <h3 style="color: #666; font-size: 1rem; margin-bottom: 5px;">Doctor Details</h3>
                                <p><strong>Name:</strong> Dr. ${prescription.doctorName}</p>
                                <p><strong>License:</strong> MED${String(prescription.doctorId).padStart(6, '0')}</p>
                                <p><strong>Date Issued:</strong> ${prescription.date}</p>
                            </div>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            <h3 style="color: #666; font-size: 1rem; margin-bottom: 10px;">Medications</h3>
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: #f8f9fa;">
                                        <th style="border: 1px solid #ddd; padding: 8px;">Medicine</th>
                                        <th style="border: 1px solid #ddd; padding: 8px;">Dosage</th>
                                        <th style="border: 1px solid #ddd; padding: 8px;">Duration</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${medicinesHtml}
                                </tbody>
                            </table>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            <h3 style="color: #666; font-size: 1rem; margin-bottom: 10px;">Instructions</h3>
                            <p>${prescription.instructions}</p>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            <h3 style="color: #666; font-size: 1rem; margin-bottom: 10px;">Follow-up</h3>
                            <p>${prescription.followUp}</p>
                        </div>
                        
                        <div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #eee;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div>
                                    <p style="border-top: 1px solid #000; width: 200px; padding-top: 5px;">
                                        Doctor's Signature
                                    </p>
                                </div>
                                <div style="text-align: right;">
                                    <p>Hospital Stamp</p>
                                </div>
                            </div>
                            <div style="text-align: center; margin-top: 20px;">
                                <p><em>This is a valid medical prescription. Do not share medications.</em></p>
                                <p>Generated on: ${new Date().toLocaleDateString()}</p>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Medical Prescriptions</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 40px; }
                        @media print {
                            body { margin: 20px; }
                            .print-content { page-break-after: always; }
                        }
                    </style>
                </head>
                <body>
                    ${printHTML}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // ========== PATIENTS FUNCTIONS ==========
        function loadPatientsList() {
            if (currentUser.role === 'patient') {
                document.getElementById('patients-table').innerHTML = `
                    <div style="text-align: center; padding: 50px;">
                        <i class="fas fa-lock" style="font-size: 3rem; color: #ccc; margin-bottom: 20px;"></i>
                        <h3>Access Restricted</h3>
                        <p>This section is only available for doctors and administrators.</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <table class="patients-table">
                    <thead>
                        <tr>
                            <th>Patient ID</th>
                            <th>Name</th>
                            <th>Age</th>
                            <th>Gender</th>
                            <th>Condition</th>
                            <th>Last Visit</th>
                            ${currentUser.role === 'doctor' ? '<th>Actions</th>' : ''}
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            patients.forEach(patient => {
                html += `
                    <tr>
                        <td>P${String(patient.id).padStart(3, '0')}</td>
                        <td>${patient.name}</td>
                        <td>${patient.age}</td>
                        <td>${patient.gender}</td>
                        <td>${patient.condition}</td>
                        <td>${patient.lastVisit}</td>
                        ${currentUser.role === 'doctor' ? `
                            <td>
                                <button class="action-btn" onclick="prescribeForPatient(${patient.id})">
                                    <i class="fas fa-prescription"></i> Prescribe
                                </button>
                                <button class="action-btn secondary" onclick="viewPatient(${patient.id})">
                                    <i class="fas fa-eye"></i> View
                                </button>
                            </td>
                        ` : ''}
                    </tr>
                `;
            });
            
            html += `</tbody></table>`;
            document.getElementById('patients-table').innerHTML = html;
        }

        function prescribeForPatient(patientId) {
            const patient = patients.find(p => p.id === patientId);
            
            document.getElementById('modal-title').textContent = `Prescribe for ${patient.name}`;
            
            const modalBody = document.getElementById('modal-body');
            modalBody.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <p><strong>Patient:</strong> ${patient.name}</p>
                    <p><strong>Condition:</strong> ${patient.condition}</p>
                </div>
                
                <div class="form-group">
                    <label>Select Medicine</label>
                    <select class="form-control" id="prescription-medicine">
                        <option value="">-- Select Medicine --</option>
                        <option value="paracetamol">Paracetamol 500mg</option>
                        <option value="ibuprofen">Ibuprofen 400mg</option>
                        <option value="cetirizine">Cetirizine 10mg</option>
                        <option value="ondansetron">Ondansetron 4mg</option>
                        <option value="vertin">Vertin 16mg</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Dosage Instructions</label>
                    <textarea class="form-control" id="dosage-instructions" rows="3" 
                              placeholder="E.g., Take 1 tablet twice daily after meals for 5 days..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>Duration (Days)</label>
                    <input type="number" class="form-control" id="duration" value="7">
                </div>
                
                <button class="btn" onclick="savePrescription(${patientId})" style="width: 100%;">
                    <i class="fas fa-save"></i> Save Prescription
                </button>
            `;
            
            document.getElementById('appointment-modal').classList.add('active');
        }

        function viewPatient(patientId) {
            const patient = patients.find(p => p.id === patientId);
            alert(`Patient Details:\n\nName: ${patient.name}\nAge: ${patient.age}\nGender: ${patient.gender}\nCondition: ${patient.condition}\nLast Visit: ${patient.lastVisit}`);
        }

        function savePrescription(patientId) {
            const medicine = document.getElementById('prescription-medicine').value;
            const instructions = document.getElementById('dosage-instructions').value;
            const duration = document.getElementById('duration').value;
            
            if (!medicine || !instructions) {
                alert('Please select medicine and enter dosage instructions');
                return;
            }
            
            const patient = patients.find(p => p.id === patientId);
            alert(`Prescription saved for ${patient.name}\n\nMedicine: ${medicine}\nDuration: ${duration} days\nInstructions: ${instructions}`);
            closeModal();
        }

        // ========== MODAL FUNCTIONS ==========
        function closeModal() {
            document.getElementById('appointment-modal').classList.remove('active');
        }

        // ========== INITIALIZATION ==========
        document.addEventListener('DOMContentLoaded', function() {
            // Load cart from localStorage
            updateCartCount();
            
            // Load appointments and prescriptions from localStorage
            appointments = JSON.parse(localStorage.getItem('appointments')) || [];
            prescriptions = JSON.parse(localStorage.getItem('prescriptions')) || [];
            
            // Set today's date for appointment booking
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('appointment-date');
            if (dateInput) {
                dateInput.min = today;
                dateInput.value = today;
            }
            
            // Close modals when clicking outside
            document.getElementById('appointment-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
            
            document.getElementById('cart-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeCart();
                }
            });
            
            // Initialize with some demo data
            if (appointments.length === 0) {
                // Add demo appointments
                const demoAppointments = [
                    {
                        id: 1,
                        patientId: 'patient123',
                        patientName: 'Patient User',
                        doctorId: 1,
                        doctorName: 'Dr. Arjun Kumar',
                        date: '2024-02-20',
                        time: '10:30 AM',
                        symptoms: 'Fever and headache',
                        type: 'clinic',
                        fee: 500,
                        status: 'approved',
                        createdAt: '2024-02-15T10:30:00Z'
                    },
                    {
                        id: 2,
                        patientId: 'patient123',
                        patientName: 'Patient User',
                        doctorId: 3,
                        doctorName: 'Dr. Raghav Sharma',
                        date: '2024-02-22',
                        time: '04:00 PM',
                        symptoms: 'Dizziness and nausea',
                        type: 'video',
                        fee: 700,
                        status: 'requested',
                        createdAt: '2024-02-16T14:20:00Z'
                    }
                ];
                
                appointments = demoAppointments;
                localStorage.setItem('appointments', JSON.stringify(appointments));
            }
        });
    </script>
</body>
</html>